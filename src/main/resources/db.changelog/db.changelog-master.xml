<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.2.xsd
      http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.2.xsd">
    <changeSet  id="1" author="tendani" >
        <sql>
            CREATE TABLE manager (
            id BIGINT NOT NULL AUTO_INCREMENT,
            firstname VARCHAR(255) NOT NULL,
            lastname VARCHAR(255) NOT NULL,
            idnumber BIGINT NOT NULL,
            role VARCHAR(255) NOT NULL,
            CONSTRAINT PK_id PRIMARY KEY (id)
            )
        </sql>
        <sql>
            CREATE TABLE agent (
            id BIGINT NOT NULL AUTO_INCREMENT,
            firstname VARCHAR(255) NOT NULL,
            lastname VARCHAR(255) NOT NULL,
            idnumber BIGINT NOT NULL,
            CONSTRAINT PK_agent_id PRIMARY KEY (id)
            )
        </sql>
        <sql>
            CREATE TABLE team (
            id BIGINT NOT NULL AUTO_INCREMENT,
            name VARCHAR(255) NOT NULL,
            manager_id BIGINT,
            agent_id BIGINT,
            CONSTRAINT PK_team_id PRIMARY KEY (id),
            CONSTRAINT fk_manager FOREIGN KEY (manager_id) REFERENCES manager(id) ON DELETE CASCADE on UPDATE CASCADE,
            CONSTRAINT fk_agent FOREIGN KEY (agent_id) REFERENCES agent(id) ON DELETE CASCADE on UPDATE CASCADE
            )
        </sql>
        <sql>
            CREATE TABLE team_manager (
            id BIGINT NOT NULL AUTO_INCREMENT,
            team_id BIGINT NOT NULL,
            manager_id BIGINT NOT NULL,
            CONSTRAINT PK_team_manager_id PRIMARY KEY (id),
            CONSTRAINT fk_team_manager FOREIGN KEY (team_id) REFERENCES team(id) ON DELETE CASCADE on UPDATE CASCADE,
            CONSTRAINT fk_manager_team FOREIGN KEY (manager_id) REFERENCES manager(id) ON DELETE CASCADE on UPDATE CASCADE,
            CONSTRAINT team_man UNIQUE (team_id, manager_id)
            )
        </sql>
    </changeSet>
</databaseChangeLog>
